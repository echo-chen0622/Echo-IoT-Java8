<mat-toolbar fxLayout="row" color="primary">
  <h2 translate>security.2fa.dialog.enable-email-title</h2>
  <span fxFlex></span>
  <button mat-icon-button
          (click)="closeDialog()"
          type="button">
    <mat-icon class="material-icons">close</mat-icon>
  </button>
</mat-toolbar>
<mat-progress-bar color="warn" mode="indeterminate" *ngIf="isLoading$ | async">
</mat-progress-bar>
<div style="height: 4px;" *ngIf="!(isLoading$ | async)"></div>
<div mat-dialog-content tb-toast style="padding: 0">
  <mat-stepper [linear]="true" #stepper>
    <ng-template matStepperIcon="edit">
      <mat-icon>done</mat-icon>
    </ng-template>
    <mat-step [stepControl]="emailConfigForm">
      <ng-template matStepLabel>{{ 'security.2fa.dialog.email-step-label' | translate }}</ng-template>
      <form [formGroup]="emailConfigForm" (ngSubmit)="nextStep()">
        <p class="mat-body step-description input" translate>security.2fa.dialog.email-step-description</p>
        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="8px">
          <mat-form-field fxFlex class="mat-block input-container" hideRequiredMarker floatLabel="always">
            <mat-label></mat-label>
            <input matInput formControlName="email"
                   type="email" required
                   placeholder="{{ 'security.2fa.dialog.email-step-label' | translate }}" />
            <mat-error *ngIf="emailConfigForm.get('email').hasError('required')">
              {{ 'user.email-required' | translate }}
            </mat-error>
            <mat-error *ngIf="emailConfigForm.get('email').hasError('email')">
              {{ 'user.invalid-email-format' | translate }}
            </mat-error>
          </mat-form-field>
          <button mat-raised-button
                  type="submit"
                  color="primary"
                  [disabled]="(isLoading$ | async) || emailConfigForm.invalid">
            {{ 'security.2fa.dialog.send-code' | translate }}
          </button>
        </div>
      </form>
    </mat-step>
    <mat-step [stepControl]="emailVerificationForm">
      <ng-template matStepLabel>{{ 'security.2fa.dialog.verification-step-label' | translate }}</ng-template>
      <form [formGroup]="emailVerificationForm" (ngSubmit)="nextStep()">
        <p class="mat-body step-description input">
          {{ 'security.2fa.dialog.verification-step-description' | translate : {address: emailConfigForm.get('email').value} }}
        </p>
        <div fxLayout="row" fxLayout.xs="column" fxLayoutAlign="space-between center" fxLayoutAlign.xs="start end">
          <mat-form-field fxFlex class="mat-block code-container full-width-xs" hideRequiredMarker floatLabel="always">
            <mat-label></mat-label>
            <input matInput formControlName="verificationCode"
                   maxlength="6" type="text" required
                   inputmode="numeric" pattern="[0-9]*"
                   autocomplete="off"
                   placeholder="{{ 'security.2fa.dialog.verification-code' | translate }}">
            <mat-error *ngIf="emailVerificationForm.get('verificationCode').invalid">
              {{ 'security.2fa.dialog.verification-code-invalid' | translate }}
            </mat-error>
          </mat-form-field>
          <div fxLayoutGap="8px">
            <button mat-button
                    matStepperPrevious
                    [disabled]="(isLoading$ | async)">
              {{ 'action.back' | translate }}
            </button>
            <button mat-raised-button
                    type="submit"
                    color="primary"
                    [disabled]="(isLoading$ | async) || emailVerificationForm.invalid">
              {{ 'action.activate' | translate }}
            </button>
          </div>
        </div>
      </form>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel matStepperIcon="done">{{ 'security.2fa.dialog.activation-step-label' | translate }}</ng-template>
      <div>
        <h3 class="result-title" translate>security.2fa.dialog.success</h3>
        <p class="mat-body result-description" translate>security.2fa.dialog.activation-step-description-email</p>
        <div fxLayout="row" fxLayoutAlign="end center">
          <button mat-raised-button
                  type="button"
                  color="primary"
                  (click)="closeDialog()">
            {{ 'action.done' | translate }}
          </button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</div>
